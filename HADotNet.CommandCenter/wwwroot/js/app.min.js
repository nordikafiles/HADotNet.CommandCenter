var HAMessageType,HAErrorType,HAEventType,HAResponseType,HAConnectionState,PageMode,__app,WeatherTileEntities;(function(n){n.Auth="auth";n.AuthRequired="auth_required";n.AuthOK="auth_ok";n.AuthInvalid="auth_invalid";n.GetStates="get_states";n.StateChanged="state_changed";n.SubscribeToEvents="subscribe_events";n.Result="result";n.Event="event";n.Ping="ping";n.Pong="pong"})(HAMessageType||(HAMessageType={})),function(n){n.IDReuse="id_reuse"}(HAErrorType||(HAErrorType={})),function(n){n.StateChanged="state_changed"}(HAEventType||(HAEventType={})),function(n){n[n.StateList=0]="StateList"}(HAResponseType||(HAResponseType={})),function(n){n[n.Closed=0]="Closed";n[n.Opening=1]="Opening";n[n.Auth=2]="Auth";n[n.Open=3]="Open"}(HAConnectionState||(HAConnectionState={}));class ConnectionEvent{constructor(){this.handlers=[]}on(n){this.handlers.push(n)}off(n){this.handlers=this.handlers.filter(t=>t!==n)}invoke(n){this.handlers.slice(0).forEach(t=>t(n))}event(){return this}}class HAConnection{constructor(n){this.targetInstance=n;this.PING_INTERVAL=3e4;this.evStateChanged=new ConnectionEvent;this.expectedResults={};this.state=HAConnectionState.Closed}get OnStateChanged(){return this.evStateChanged.event()}initialize(){this.state=HAConnectionState.Opening;this.msgId=1;this.ws&&this.ws.readyState===this.ws.OPEN||(this.ws=new ReconnectingWebSocket(this.parseSocketUrl(this.targetInstance),null,{automaticOpen:!1}));this.ws.addEventListener("open",()=>this.handleOpen());this.ws.addEventListener("close",()=>this.handleClose());this.ws.addEventListener("message",n=>this.handleMessage(n));this.ws.open()}refreshAllStates(){this.sendStateRequest()}handleMessage(n){let t=JSON.parse(n.data);if(this.isHAMessage(t)){console.debug("-> RCV:"+t.type,t);switch(t.type){case HAMessageType.AuthRequired:this.sendAuth();return;case HAMessageType.AuthOK:this.isReady();return;case HAMessageType.Result:let n=t;n.success?this.handleHaExpectedResult(n)?delete this.expectedResults[n.id]:console.info("HA result OK",n):this.handleHaError(n.error);return;case HAMessageType.Event:this.handleHaEvent(t);return;case HAMessageType.AuthInvalid:console.error("Unable to authenticate with Home Assistant API. Check settings.");this.ws.maxReconnectAttempts=1;this.ws.close();return}}else console.warn("-> RCV",n.data)}isReady(){this.state=HAConnectionState.Open;this.pingInterval=window.setInterval(()=>this.sendPing(),this.PING_INTERVAL);this.sendEventSubscriptionRequest(HAEventType.StateChanged)}handleHaEvent(n){this.isHAEventStateChanged(n.event)&&this.eventStateChanged(n.event)}handleHaExpectedResult(n){let t=this.expectedResults[n.id];if(typeof t!="undefined"){switch(t){case HAResponseType.StateList:this.resultStateList(n.result);break;default:console.warn("Unhandled response type for this message.",n)}return!0}return!1}resultStateList(n){for(let n of n)this.evStateChanged.invoke({data:{entity_id:n.entity_id,new_state:n,old_state:null},event_type:HAEventType.StateChanged,origin:null,time_fired:null})}eventStateChanged(n){var i,t;console.info(`HA State Changed [${n.data.entity_id}] ${t=(i=n.data.old_state)===null||i===void 0?void 0:i.state,t!==null&&t!==void 0?t:"<NULL>"} -> ${n.data.new_state.state}`);this.evStateChanged.invoke(n)}sendAuth(){this.send({type:HAMessageType.Auth,access_token:window.ccOptions.token})}sendStateRequest(){let n=this.send({type:HAMessageType.GetStates});this.expectedResults[n]=HAResponseType.StateList}sendEventSubscriptionRequest(n){this.send({type:HAMessageType.SubscribeToEvents,event_type:n})}handleHaError(n){console.error("HA API Error ["+n.code+"] "+n.message)}sendPing(){this.send({type:HAMessageType.Ping})}send(n){return console.debug("<- SND:"+n.type,n),this.state!==HAConnectionState.Closed&&this.state!==HAConnectionState.Opening?(this.state===HAConnectionState.Open&&(n.id=this.msgId++),this.ws.send(JSON.stringify(n)),n.id):(console.warn("Tried to send socket message, but connection isn't ready.",n),-1)}handleOpen(){this.state=HAConnectionState.Auth}handleClose(){this.state=HAConnectionState.Closed;this.pingInterval&&(window.clearInterval(this.pingInterval),this.pingInterval=0)}parseSocketUrl(n){let t=document.createElement("a");return t.href=n,`${t.protocol.toLowerCase()==="https:"?"wss":"ws"}://${t.host}/api/websocket`}isHAMessage(n){return n&&typeof n.type=="string"}isHAEventStateChanged(n){return n&&typeof n.event_type=="string"&&n.event_type===HAEventType.StateChanged}}(function(n){n[n.User=0]="User";n[n.Admin=1]="Admin"})(PageMode||(PageMode={}));class Utils{static delayPromise(n,...t){return new Promise(i=>setTimeout(()=>i(t),n))}static resolveIcon(n,t){return t&&t.length?t:n&&n.length&&/^mdi:/i.test(n)?n.replace("mdi:",""):""}static preloadImage(n){return new Promise((t,i)=>{let r=new Image;r.onload=()=>t(n);r.onerror=n=>i(n);r.src=n})}static convertDegreesToCardinal(n){return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.floor(n/22.5+.5)%16]}static convertCardinalToIcon(n){return{N:"arrow-up-thick",NNE:"arrow-up-thick",NE:"arrow-top-right-thick",ENE:"arrow-right-thick",E:"arrow-right-thick",ESE:"arrow-right-thick",SE:"arrow-bottom-right-thick",SSE:"arrow-down-thick",S:"arrow-down-thick",SSW:"arrow-down-thick",SW:"arrow-bottom-left-thick",WSW:"arrow-left-thick",W:"arrow-left-thick",WNW:"arrow-left-thick",NW:"arrow-top-left-thick",NNW:"arrow-up-thick"}[n]}}class Tile{constructor(n,t,i,r=true){var u;this.page=n;this.name=t;this.conn=i;this.canLoad=r;this.el=$(`.tiles .tile[data-tile-name="${t}"]`);this.entityId=(u=this.el.data("tile-entityid"))===null||u===void 0?void 0:u.toString();r&&this.el.click(()=>{this.onClick().then(()=>Utils.delayPromise(500)).then(()=>{this.requestState(1e3)})});i.on("SendSystemConfig",(n,i)=>{t==n&&(this.config=i,this.canLoad&&this.requestState())});i.on("SendTile",n=>{t==n.name&&(console.debug(`Received: "SendTile" for tile: ${n.name}`),this.updateTileState(n))});i.on("SendTileState",(n,i)=>{t==n.name&&(console.debug(`Received: "SendTileState" for tile: ${n.name}`),this.updateState(n,i))});i.on("SendTileStates",(n,i)=>{t==n.name&&(console.debug(`Received: "SendTileStates" for tile: ${n.name}`),this.updateStates(n,i))});i.on("SendCalendarInfo",(n,i,r)=>{t==n.name&&(console.debug(`Received: "SendCalendarInfo" for tile: ${n.name}`),this.updateCalendar(n,i,r))});i.on("SendWarning",n=>console.warn(n));i.on("SendDateTime",(n,i,r)=>{t==n.name&&(console.debug(`Received: "SendDateTime" for tile: ${n.name}`),this.updateState(n,i,r))});this.canLoad&&this.requestState()}onClick(){return this.conn.invoke("OnTileClicked",this.page,this.name)}updateTileState(){this.disableLoading()}updateState(){this.disableLoading()}updateStates(){this.disableLoading()}updateCalendar(){this.disableLoading()}requestState(n){this.enableLoading(n);console.debug(`Sending: "RequestTileState" for tile: ${this.name}`);this.conn.invoke("RequestTileState",this.page,this.name)}requestConfig(){this.conn.invoke("RequestConfig",this.name)}enableLoading(n){this.el.hasClass("tile-loading")||this.loadingDebouncer||(n||this.debounceTimeMs?this.loadingDebouncer=window.setTimeout(()=>{this.el.addClass("tile-loading")},n||this.debounceTimeMs):this.el.addClass("tile-loading"))}disableLoading(){this.loadingDebouncer&&window.clearTimeout(this.loadingDebouncer);this.loadingDebouncer=null;this.el.removeClass("tile-loading")}getEntityId(){return this.entityId}}class BlankTile extends Tile{constructor(n,t,i){super(n,t,i,!1)}}class LabelTile extends Tile{constructor(n,t,i){super(n,t,i,!1)}}class DateTile extends Tile{updateState(n,t,i){$(`#tile-${n.name}`).find("span[value-date]").text(t);$(`#tile-${n.name}`).find("span[value-time]").text(i);super.updateState();setTimeout(()=>{this.requestState(9500)},1e4)}}class StateTile extends Tile{updateState(n,t){let i=t.attributes.friendly_name.toString();n.overrideLabel&&(i=n.overrideLabel);$(`#tile-${n.name}`).find("span[value-name]").text(i);let r=t.state;t.attributes.unit_of_measurement&&(r+=t.attributes.unit_of_measurement.toString());$(`#tile-${n.name}`).find("span[value-state]").text(r);super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(1e3)},n.refreshRate*1e3)}}class LightTile extends Tile{updateState(n,t){var i=n;let r=t.attributes.friendly_name.toString();n.overrideLabel&&(r=n.overrideLabel);$(`#tile-${n.name}`).find("span[value-name]").text(r);$(`#tile-${n.name}`).find("span[value-icon]").removeClass(`mdi-${i.displayIcon} mdi-${i.displayOffIcon}`).addClass(`mdi mdi-${t.state.toLowerCase()==="on"?Utils.resolveIcon(t.attributes.icon,i.displayIcon):Utils.resolveIcon(t.attributes.icon,i.displayOffIcon||i.displayIcon)}`);$(`#tile-${n.name}`).find("span[value-icon]").removeClass("state-off state-on").addClass(t.state.toLowerCase()==="on"?"state-on":"state-off");i.onColor&&t.state.toLowerCase()==="on"&&$(`#tile-${n.name} .value`).css("color",i.onColor);i.offColor&&t.state.toLowerCase()!=="on"&&$(`#tile-${n.name} .value`).css("color",i.offColor);super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(2e3)},n.refreshRate*1e3)}}class SwitchTile extends Tile{updateState(n,t){var i=n;let r=t.attributes.friendly_name.toString();n.overrideLabel&&(r=n.overrideLabel);$(`#tile-${n.name}`).find("span[value-name]").text(r);$(`#tile-${n.name}`).find("span[value-icon]").removeClass(`mdi-${i.displayIcon} mdi-${i.displayOffIcon}`).addClass(`mdi mdi-${t.state.toLowerCase()==="on"?Utils.resolveIcon(t.attributes.icon,i.displayIcon):Utils.resolveIcon(t.attributes.icon,i.displayOffIcon||i.displayIcon)}`);$(`#tile-${n.name}`).find("span[value-icon]").removeClass("state-off state-on").addClass(t.state.toLowerCase()==="on"?"state-on":"state-off");i.onColor&&t.state.toLowerCase()==="on"&&$(`#tile-${n.name} .value`).css("color",i.onColor);i.offColor&&t.state.toLowerCase()!=="on"&&$(`#tile-${n.name} .value`).css("color",i.offColor);super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(2e3)},n.refreshRate*1e3)}}class PersonTile extends Tile{updateState(n,t){let u=t.attributes.entity_picture?t.attributes.entity_picture.toString():"",i=t.state.replace("_"," "),r=t.attributes.friendly_name.toString();n.overrideLabel&&(r=n.overrideLabel);let f=i.toLowerCase()==="home";$(`#tile-${n.name}`).find("span[value-name]").text(r);$(`#tile-${n.name}`).find("span[value-location]").text(i);$(`#tile-${n.name}`).find("span[value-picture]").css("background-image",`url(${u})`).removeClass("bw");f||$(`#tile-${n.name}`).find("span[value-picture]").addClass("bw");super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(2e3)},n.refreshRate*1e3)}}class WeatherTile extends Tile{constructor(n,t,i,r=true){super(n,t,i,r);this.page=n;this.name=t;this.conn=i;this.canLoad=r;this.iconEl=this.el.find(".condition-icon")[0];const u=document.defaultView.getComputedStyle(this.el[0]).color;this.skycons=new Skycons({color:u,resizeClear:!0});this.skycons.add(this.iconEl,Skycons.CLEAR_DAY)}updateStates(n,t){let f="",i="",r="",u="";for(let e in t){let o=t[e]==null?null:t[e].state;switch(e){case WeatherTileEntities.entityId:t[e].attributes.unit_of_measurement&&(o+=t[e].attributes.unit_of_measurement.toString());$(`#tile-${n.name}`).find("span[value-temp]").text(o);break;case WeatherTileEntities.highTempEntity:t[e].attributes.unit_of_measurement&&(o+=t[e].attributes.unit_of_measurement.toString());r=`<i class="mdi mdi-arrow-up-thick"></i> ${o}`;break;case WeatherTileEntities.lowTempEntity:t[e].attributes.unit_of_measurement&&(o+=t[e].attributes.unit_of_measurement.toString());u=`<i class="mdi mdi-arrow-down-thick"></i> ${o}`;break;case WeatherTileEntities.summaryEntity:$(`#tile-${n.name}`).find("span[value-summary]").text(o);break;case WeatherTileEntities.precipChanceEntity:t[e].attributes.unit_of_measurement&&(o+=t[e].attributes.unit_of_measurement.toString());$(`#tile-${n.name}`).find("span[value-rain]").text(`Rain: ${o}`);break;case WeatherTileEntities.windSpeedEntity:t[e].attributes.unit_of_measurement&&(o+=t[e].attributes.unit_of_measurement.toString());f=o;break;case WeatherTileEntities.windDirectionEntity:i=Utils.convertDegreesToCardinal(parseInt(o));i=`<i class="mdi mdi-${Utils.convertCardinalToIcon(i)}"></i> ${i}`;break;case WeatherTileEntities.iconEntity:o?(this.skycons.set(this.iconEl,o),this.skycons.play()):(this.skycons.remove(this.iconEl),$(this.iconEl).hide())}}$(`#tile-${n.name}`).find("span[value-hi-lo]").html(`${r&&u?r+" / "+u:r+u}`);$(`#tile-${n.name}`).find("span[value-wind]").html(`Wind: ${(f+" "+i).trim()}`);super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(2e3)},n.refreshRate*1e3)}}class CameraTile extends Tile{constructor(n,t,i){super(n,t,i,!0);this.firstLoadIgnored=!1;this.requestConfig()}updateState(n,t){var i=n;if(this.config&&this.config.baseUrl){const r=Math.floor(Math.random()*Math.floor(99999999));let u=this.config.baseUrl+t.attributes.entity_picture.toString()+"&_nocache="+r;Utils.preloadImage(u).then(t=>{let r=i.imageCropMode.toLowerCase()==="cover"||i.imageCropMode.toLowerCase()==="contain"?i.imageCropMode.toLowerCase():"100% 100%",u=i.imageCropMode.toLowerCase()==="cover"||i.imageCropMode.toLowerCase()==="contain"?"50% 50%":"0 0";$(`#tile-${n.name}`).css({backgroundImage:`url('${t}')`,backgroundRepeat:"no-repeat",backgroundPosition:u,backgroundSize:r})}).finally(()=>this.queueTileRefresh(n,!0))}else this.firstLoadIgnored?console.warn("Missing config.baseUrl, unable to render camera display.",this.config):this.firstLoadIgnored=!0,this.queueTileRefresh(n)}queueTileRefresh(n,t){t&&super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(n.refreshRate*1e3-100)},n.refreshRate*1e3)}}class SceneTile extends Tile{updateState(n,t){var i=n;let r=t.attributes.friendly_name.toString();n.overrideLabel&&(r=n.overrideLabel);$(`#tile-${n.name}`).find("span[value-name]").text(r);$(`#tile-${n.name}`).find("span[value-icon]").addClass(`mdi mdi-${i.displayIcon||"filmstrip"}`);$(`#tile-${n.name} .value`).css("color",i.iconColor);super.updateState()}}class MediaTile extends Tile{constructor(n,t,i){super(n,t,i,!0);this.firstLoadIgnored=!1;this.requestConfig()}updateState(n,t){var i=n;let r=t.attributes.friendly_name.toString();if(n.overrideLabel&&(r=n.overrideLabel),$(`#tile-${n.name}`).toggleClass("media-idle",t.attributes.media_title==="Nothing playing"||(t.state=="paused"||t.state=="idle")&&!t.attributes.entity_picture),$(`#tile-${n.name}`).find("span[value-name]").text(i.showLabel?r:""),$(`#tile-${n.name}`).find("span[value-title]").text(i.showTitle&&t.attributes.media_title&&t.attributes.media_title!=="Nothing playing"?t.attributes.media_title.toString():""),this.config&&this.config.baseUrl){if(!t.attributes.entity_picture){this.queueTileRefresh(n,!0);return}const r=Math.floor(Math.random()*Math.floor(99999999));let u=this.config.baseUrl+t.attributes.entity_picture.toString()+"&_nocache="+r;Utils.preloadImage(u).then(t=>{let r=i.imageCropMode.toLowerCase()==="cover"||i.imageCropMode.toLowerCase()==="contain"?i.imageCropMode.toLowerCase():"100% 100%",u=i.imageCropMode.toLowerCase()==="cover"||i.imageCropMode.toLowerCase()==="contain"?"50% 50%":"0 0";$(`#tile-${n.name}`).css({backgroundImage:`url('${t}')`,backgroundRepeat:"no-repeat",backgroundPosition:u,backgroundSize:r})}).finally(()=>this.queueTileRefresh(n,!0))}else this.firstLoadIgnored?console.warn("Missing config.baseUrl, unable to render media display.",this.config):this.firstLoadIgnored=!0,this.queueTileRefresh(n)}queueTileRefresh(n,t){t&&super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(n.refreshRate*1e3-100)},n.refreshRate*1e3)}}class NavigationTile extends Tile{updateTileState(n){this.navTile=n;$(`#tile-${n.name}`).find("span[value-name]").text(this.navTile.label);$(`#tile-${n.name}`).find("span[value-icon]").addClass(`mdi mdi-${this.navTile.displayIcon}`);super.updateState()}onClick(){switch(this.navTile.mode.toLowerCase().trim()){case"home":window.location.href="/d/";return;case"refresh":window.location.reload();return;case"nav":window.location.href=`/d/${this.navTile.target}`;return}}}class CalendarTile extends Tile{constructor(n,t,i){super(n,t,i,!0);this.eventContainer=$(`#tile-${t} div.calendar-events`)}updateCalendar(n,t,i){let r=t.attributes.friendly_name.toString();n.overrideLabel&&(r=n.overrideLabel);$(`#tile-${n.name}`).find("span[value-name]").text(r);this.refreshEvents(i);super.updateState();n.refreshRate>0&&setTimeout(()=>{this.requestState(1e3)},n.refreshRate*1e3)}refreshEvents(n){if(this.eventContainer.empty(),n.length){let t="";for(let i=0;i<n.length;i++){const r=n[i],u=this.getEventHeader(r);t!=u&&(this.eventContainer.append(`<h3>${u}</h3>`),t=u);this.eventContainer.append(`<p><span class="summary">${r.summary}</span><span class="time">${moment(r.start.dateTime).format("LT")}</span></p>`)}}else this.eventContainer.append('<span class="no-events">No events!<\/span>')}getEventHeader(n){const i=moment(),r=moment().add(1,"day");let u=this.formatHeader(i),f=this.formatHeader(r);const e=moment(n.start.dateTime);let t=this.formatHeader(e);return t===u?t+=" (Today)":t===f&&(t+=" (Tomorrow)"),t}formatHeader(n){return n.format("ddd")+", "+n.format("ll")}}class TileMap{}TileMap.ClassMap={Blank:BlankTile,Label:LabelTile,Date:DateTile,State:StateTile,Light:LightTile,Switch:SwitchTile,Person:PersonTile,Weather:WeatherTile,Camera:CameraTile,Scene:SceneTile,Media:MediaTile,Navigation:NavigationTile,Calendar:CalendarTile};class CommandCenter{constructor(){this.tiles=[];$(()=>this.init())}init(){window.ccOptions.mode==PageMode.Admin?this.initAdmin():this.initUser();this.initializeMdiPreview();this.initializeColorPreview()}initAdmin(){$(window).on("beforeunload",n=>{if(this.pageIsDirty&&$(n.target.activeElement).prop("type")!=="submit")return"You have unsaved changes. Are you sure you want to leave?"});if($("#importTheme, #importConfig").click(()=>{confirm("WARNING: This will OVERWRITE your current settings. Export first if you want to save what you have now! Continue?")&&$("#importBrowser").click()}),$("#importBrowser").change(()=>{$("#importForm").submit()}),$("#resetConfig").click(n=>confirm("WARNING: This will COMPLETELY RESET your HACC installation and PERMANENTLY DELETE all of your tiles, themes, and settings. Are you sure you want to reset your config?")?!0:(n.preventDefault(),!1)),$(".ui.accordion").accordion(),$(".ui.checkbox").checkbox(),$(".ui.dropdown").not(".no-placeholder").dropdown({fullTextSearch:!0}),$(".ui.no-placeholder.dropdown").dropdown({placeholder:!1}),$("#Page_PageFontFace option").each(function(n,t){$(t).parent().siblings(".menu").find('.item[data-value="'+$(t).text()+'"]').css("font-family",$(t).text())}),$(".preview-layout-grid").length){$("#auto-layout").click(()=>this.pk.layout());$(".preview-layout-grid").prepend(`<div class="preview-layout-item" style="opacity: 0; position: absolute; top: ${window.ccOptions.tilePreviewPadding}px; left: ${window.ccOptions.tilePreviewPadding}px; width: ${window.ccOptions.tilePreviewSize}px; height: ${window.ccOptions.tilePreviewSize}px;" id="grid__tmp"></div>`);this.pk=window.ccOptions?new Packery(".preview-layout-grid",{itemSelector:".preview-layout-item",columnWidth:window.ccOptions.tilePreviewSize,rowHeight:window.ccOptions.tilePreviewSize,gutter:window.ccOptions.tilePreviewPadding,initLayout:!1}):new Packery(".preview-layout-grid",{itemSelector:".preview-layout-item",columnWidth:".preview-layout-item",rowHeight:".preview-layout-item",gutter:window.ccOptions.tilePreviewPadding,initLayout:!1});this.pk.on("layoutComplete",()=>this.writeItemLayout());this.pk.on("dragItemPositioned",()=>{setTimeout(()=>{this.writeItemLayout(),this.pageIsDirty=!0},25)});this.writeItemLayout();typeof Draggabilly=="function"?$(".preview-layout-item").each((n,t)=>this.pk.bindDraggabillyEvents(new Draggabilly(t,{containment:".preview-layout-grid"}))):console.warn("Draggabilly is not available - drag and drop interface will not work.");$("#grid__tmp").remove();this.pk.initShiftLayout(Array.from(document.querySelectorAll(".preview-layout-grid > .preview-layout-item")))}}initUser(){window.ccOptions.baseUrl&&(this.conn=new HAConnection(window.ccOptions.baseUrl));this.conn.OnStateChanged.on(n=>{var t=this.findTilesByEntityId(n.data.entity_id);for(let t of t)console.info(`Updating tile for entity "${t.getEntityId()}" to state "${n.data.new_state.state}".`)});this.conn.initialize();this.tileConn=(new signalR.HubConnectionBuilder).withUrl("/hubs/tile").build();this.tileConn.start().then(()=>{$(".tiles .tile").each((n,t)=>{try{let n=new TileMap.ClassMap[$(t).data("tile-type").toString()](window.ccOptions.pageId,$(t).data("tile-name"),this.tileConn);this.tiles.push(n)}catch(i){console.error('Error instantiating class "'+($(t).data("tile-type")||"__MISSING__")+'Tile". Was it added to the tile type map?',i,t)}}),this.conn.refreshAllStates(),window.ccOptions.autoReturn>0&&window.setTimeout(()=>window.location.href="/d/",window.ccOptions.autoReturn*1e3)})}findTilesByEntityId(n){return this.tiles.filter(t=>{let i=t.getEntityId();return i&&i.toLowerCase()===n.toLowerCase()})}initializeMdiPreview(){$(".mdi-icon-placeholder + input").each((n,t)=>{$(t).keyup(n=>{this.refreshDynamicIcon(n.currentTarget)}),this.refreshDynamicIcon(t)})}refreshDynamicIcon(n){$(n).parent().children(".mdi-icon-placeholder").attr("class","large icon mdi-icon-placeholder").addClass(`mdi mdi-${$(n).val()}`)}initializeColorPreview(){$(".color-preview + input").each((n,t)=>{$(t).keyup(n=>{this.refreshDynamicColor(n.currentTarget)}),this.refreshDynamicColor(t)})}refreshDynamicColor(n){$(n).parent().children(".color-preview").css("color",`${$(n).val()}`)}writeItemLayout(){var n=[],t=this.pk.getItemElements();for(let i=0;i<t.length;i++){let r=$(t[i]);n.push({index:i,x:parseInt(r.css("left").replace("px","")),y:parseInt(r.css("top").replace("px","")),name:r.data("tile-name")})}$("#layout-serialized").val(JSON.stringify(n))}}__app=new CommandCenter;Packery.prototype.initShiftLayout=function(n){this._resetLayout();this.items=n.map(function(n){var t=this.getItem(n);let i=parseInt(n.style.left.replace("px","")),r=parseInt(n.style.top.replace("px","")),u=n.clientWidth,f=n.clientHeight;return t.rect.x=i-this.gutter,t.rect.y=r,t.rect.height=f,t.rect.width=u,t.position.x=i-this.gutter,t.position.y=r,t},this);this.shiftLayout()},function(n){n.entityId="entityId";n.iconEntity="iconEntity";n.summaryEntity="summaryEntity";n.precipChanceEntity="precipChanceEntity";n.highTempEntity="highTempEntity";n.lowTempEntity="lowTempEntity";n.windSpeedEntity="windSpeedEntity";n.windDirectionEntity="windDirectionEntity"}(WeatherTileEntities||(WeatherTileEntities={}));